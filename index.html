<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompTIA Security+ Acronym Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF7; /* Warm neutral background */
            color: #1F2937;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }

        /* Flip Card Animation */
        .perspective-1000 {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        /* Chart Container Specifics */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        .active-tab {
            border-bottom: 3px solid #0D9488; /* Teal-600 */
            color: #0F766E;
            font-weight: 600;
        }
        
        .inactive-tab {
            border-bottom: 3px solid transparent;
            color: #6B7280;
        }
        .inactive-tab:hover {
            color: #374151;
            border-bottom: 3px solid #E5E7EB;
        }

        /* Smooth fade */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0D9488;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals with Teal/Sage Accents -->
    <!-- Application Structure Plan: 
         1. Dashboard/Analytics: High-level overview.
         2. Library (Browse): Core list with Gemini "Deep Dive" feature.
         3. Flashcards: Active recall study mode.
         4. Quiz Challenge: Gamified validation with Gemini "Infinite Quiz" feature.
         5. AI Modal: Shared UI component for displaying Gemini results.
    -->
    <!-- Visualization & Content Choices:
         - Pie/Bar Charts for stats.
         - Interactive Cards for terms.
         - Modal for AI content.
         - Gemini API Integration for explanations and dynamic questions.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation Bar -->
    <nav class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <span class="text-2xl font-bold text-teal-700">CompTIA Sec+</span>
                        <span class="text-gray-500 font-medium">Study Hub</span>
                    </div>
                    <div class="hidden sm:ml-8 sm:flex sm:space-x-8" id="desktop-nav">
                        <!-- Nav items populated by JS -->
                    </div>
                </div>
                <div class="flex items-center">
                    <button id="mobile-menu-btn" class="sm:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none">
                        <span class="sr-only">Open menu</span>
                        &#9776; <!-- Hamburger Icon -->
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div class="sm:hidden hidden bg-white border-t border-gray-100" id="mobile-menu">
            <div class="pt-2 pb-3 space-y-1 px-4" id="mobile-nav-items">
                <!-- Mobile items populated by JS -->
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full relative">
        
        <!-- AI Modal Overlay -->
        <div id="ai-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-[60] flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto transform transition-all flex flex-col">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-teal-50 to-white">
                    <h3 class="text-xl font-bold text-teal-800 flex items-center gap-2">
                        <span>✨</span> <span id="ai-modal-title">AI Insight</span>
                    </h3>
                    <button onclick="app.closeAIModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <div class="p-8">
                    <div id="ai-loading" class="hidden flex flex-col items-center justify-center py-8">
                        <div class="loader mb-4"></div>
                        <p class="text-gray-500 animate-pulse">Consulting the cybersecurity oracle...</p>
                    </div>
                    <div id="ai-content" class="text-gray-700 leading-relaxed whitespace-pre-wrap font-medium"></div>
                </div>
                <div class="p-4 border-t border-gray-100 bg-gray-50 flex justify-end">
                    <button onclick="app.closeAIModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">Close</button>
                </div>
            </div>
        </div>

        <!-- View: Analytics (Dashboard) -->
        <section id="view-dashboard" class="fade-in space-y-8">
            <div class="text-center max-w-3xl mx-auto mb-10">
                <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight sm:text-5xl mb-4">Master the Language of Security</h1>
                <p class="text-lg text-gray-600">
                    Success in the CompTIA Security+ exam requires fluency in industry terminology. 
                    This interactive hub breaks down essential acronyms into manageable domains, allowing you to visualize the landscape, 
                    browse definitions, and test your retention.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Stats Card 1 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col">
                    <div class="mb-4 border-b border-gray-100 pb-2">
                        <h2 class="text-xl font-bold text-gray-800">Domain Distribution</h2>
                        <p class="text-sm text-gray-500">Breakdown of acronyms across official exam domains.</p>
                    </div>
                    <div class="flex-grow flex items-center justify-center bg-gray-50 rounded-lg p-4">
                        <div class="chart-container">
                            <canvas id="domainChart"></canvas>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500 text-center">
                        Visualizing where the bulk of technical jargon lies helps prioritize your study sessions.
                    </div>
                </div>

                <!-- Stats Card 2 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col">
                    <div class="mb-4 border-b border-gray-100 pb-2">
                        <h2 class="text-xl font-bold text-gray-800">Complexity Analysis</h2>
                        <p class="text-sm text-gray-500">Estimated conceptual depth of terms.</p>
                    </div>
                    <div class="flex-grow flex items-center justify-center bg-gray-50 rounded-lg p-4">
                        <div class="chart-container">
                            <canvas id="complexityChart"></canvas>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500 text-center">
                        Most terms are foundational, but 'Advanced' concepts often involve multi-step processes or protocols.
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button onclick="app.switchView('library')" class="p-6 bg-teal-50 rounded-xl border border-teal-100 hover:bg-teal-100 transition-colors text-left group">
                    <div class="text-teal-600 text-2xl mb-2 group-hover:scale-110 transition-transform origin-left">&#128214;</div>
                    <h3 class="font-bold text-teal-900">Browse Library</h3>
                    <p class="text-sm text-teal-700">Search and filter the full glossary.</p>
                </button>
                <button onclick="app.switchView('flashcards')" class="p-6 bg-amber-50 rounded-xl border border-amber-100 hover:bg-amber-100 transition-colors text-left group">
                    <div class="text-amber-600 text-2xl mb-2 group-hover:scale-110 transition-transform origin-left">&#128161;</div>
                    <h3 class="font-bold text-amber-900">Flashcards</h3>
                    <p class="text-sm text-amber-700">Test your memory with flip cards.</p>
                </button>
                <button onclick="app.switchView('quiz')" class="p-6 bg-indigo-50 rounded-xl border border-indigo-100 hover:bg-indigo-100 transition-colors text-left group">
                    <div class="text-indigo-600 text-2xl mb-2 group-hover:scale-110 transition-transform origin-left">&#127919;</div>
                    <h3 class="font-bold text-indigo-900">Take a Quiz</h3>
                    <p class="text-sm text-indigo-700">Challenge yourself with multiple choice.</p>
                </button>
            </div>
        </section>

        <!-- View: Library -->
        <section id="view-library" class="hidden fade-in space-y-6">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900">Term Library</h2>
                <p class="text-gray-600 mt-2">
                    Use the filters below to narrow down terms by specific exam domains, or use the search bar to find specific acronyms like "DLP" or "XSS".
                </p>
            </div>

            <!-- Controls -->
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col md:flex-row gap-4 justify-between items-center sticky top-20 z-40">
                <div class="w-full md:w-1/3 relative">
                    <input type="text" id="searchInput" placeholder="Search acronyms or definitions..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors">
                    <span class="absolute left-3 top-2.5 text-gray-400">&#128269;</span>
                </div>
                <div class="w-full md:w-2/3 flex flex-wrap gap-2 justify-end" id="domain-filters">
                    <!-- Filters injected via JS -->
                </div>
            </div>

            <!-- Results Grid -->
            <div id="library-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Cards injected via JS -->
            </div>
            
            <div id="no-results" class="hidden text-center py-12 text-gray-500">
                No terms found matching your criteria.
            </div>
        </section>

        <!-- View: Flashcards -->
        <section id="view-flashcards" class="hidden fade-in flex flex-col items-center justify-center min-h-[60vh]">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900">Active Recall</h2>
                <p class="text-gray-600 mt-2">Click the card to flip it. Spacebar also flips.</p>
            </div>

            <!-- Flashcard Container -->
            <div class="relative w-full max-w-2xl h-80 perspective-1000 group cursor-pointer" onclick="app.flipCard()">
                <div id="flashcard-inner" class="relative w-full h-full text-center transition-transform duration-500 transform-style-3d shadow-xl rounded-2xl">
                    <!-- Front -->
                    <div class="absolute w-full h-full backface-hidden bg-white border-2 border-teal-500 rounded-2xl flex flex-col items-center justify-center p-8">
                        <span class="text-sm uppercase tracking-widest text-teal-600 font-semibold mb-4" id="card-domain">Domain</span>
                        <h3 class="text-6xl font-black text-gray-800 tracking-tight" id="card-front">ACRONYM</h3>
                        <p class="mt-6 text-gray-400 text-sm font-medium">Click to reveal definition</p>
                    </div>
                    <!-- Back -->
                    <div class="absolute w-full h-full backface-hidden bg-teal-600 text-white rounded-2xl flex flex-col items-center justify-center p-8 rotate-y-180">
                        <h4 class="text-2xl font-bold mb-4 border-b border-teal-400 pb-2" id="card-fullform">Full Form</h4>
                        <p class="text-lg leading-relaxed" id="card-def">Definition goes here.</p>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-6 mt-10">
                <button onclick="app.prevCard()" class="px-6 py-3 bg-white border border-gray-300 rounded-full hover:bg-gray-50 font-medium shadow-sm transition-transform active:scale-95">
                    &#8592; Previous
                </button>
                <span id="card-counter" class="text-gray-500 font-mono">1 / 100</span>
                <button onclick="app.nextCard()" class="px-6 py-3 bg-teal-600 text-white border border-transparent rounded-full hover:bg-teal-700 font-medium shadow-md transition-transform active:scale-95">
                    Next &#8594;
                </button>
            </div>
        </section>

        <!-- View: Quiz -->
        <section id="view-quiz" class="hidden fade-in max-w-3xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-4">
                <div class="text-center md:text-left">
                    <h2 class="text-3xl font-bold text-gray-900">Knowledge Check</h2>
                    <p class="text-gray-600 mt-2">Select the correct definition for the acronym shown.</p>
                </div>
                <button onclick="app.generateAIQuiz()" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg shadow hover:shadow-lg transition-all flex items-center gap-2 text-sm font-bold whitespace-nowrap">
                    <span>✨</span> Generate AI Question
                </button>
            </div>

            <div id="quiz-container" class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden relative">
                <!-- AI Badge overlay -->
                <div id="ai-quiz-badge" class="hidden absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500"></div>

                <!-- Question Header -->
                <div class="bg-gray-50 p-6 border-b border-gray-100 flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-500 uppercase tracking-wider">Question <span id="quiz-q-num">1</span></span>
                    <span class="px-3 py-1 bg-teal-100 text-teal-800 text-xs font-bold rounded-full" id="quiz-score">Score: 0</span>
                </div>

                <!-- Question Body -->
                <div class="p-8 text-center" id="quiz-body">
                    <h3 class="text-sm text-gray-500 mb-2">What does this stand for?</h3>
                    <div class="text-5xl font-black text-gray-800 mb-8" id="quiz-question">ACRONYM</div>
                    
                    <div class="grid grid-cols-1 gap-3" id="quiz-options">
                        <!-- Options injected -->
                    </div>
                </div>
                
                <!-- Loading State for AI Quiz -->
                <div id="quiz-loading" class="hidden p-12 text-center">
                    <div class="loader mx-auto mb-4"></div>
                    <p class="text-gray-500">Generating a unique challenge using Gemini AI...</p>
                </div>

                <!-- Feedback Area -->
                <div id="quiz-feedback" class="hidden p-4 text-center font-bold text-white transition-colors duration-300">
                    <!-- Correct/Incorrect message -->
                </div>

                <div class="p-4 bg-gray-50 border-t border-gray-100 text-center">
                    <button onclick="app.nextQuizQuestion()" class="text-teal-600 font-bold hover:text-teal-800 transition-colors">Skip / Next &rarr;</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
            <p>Designed for CompTIA Security+ Exam Preparation.</p>
            <p class="mt-1">Content covers standard domains: Threats, Architecture, Implementation, Operations, and Governance.</p>
        </div>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        const apiKey = ""; // API Key injected by environment

        const appData = [
            // Threats, Attacks, and Vulnerabilities
            { acr: "APT", full: "Advanced Persistent Threat", def: "A stealthy computer network threat actor, typically a nation-state or state-sponsored group, which gains unauthorized access to a computer network and remains undetected for an extended period.", domain: "Threats" },
            { acr: "DoS", full: "Denial of Service", def: "An attack meant to shut down a machine or network, making it inaccessible to its intended users.", domain: "Threats" },
            { acr: "DDoS", full: "Distributed Denial of Service", def: "A DoS attack where the traffic flooding the victim originates from many different sources.", domain: "Threats" },
            { acr: "MITM", full: "Man-in-the-Middle", def: "An attack where the attacker secretly relays and possibly alters the communications between two parties who believe they are directly communicating with each other.", domain: "Threats" },
            { acr: "XSS", full: "Cross-Site Scripting", def: "A vulnerability that allows attackers to inject malicious scripts into web pages viewed by other users.", domain: "Threats" },
            { acr: "SQLi", full: "SQL Injection", def: "A code injection technique used to attack data-driven applications, allowing an attacker to interfere with the queries an application makes to its database.", domain: "Threats" },
            { acr: "OSINT", full: "Open Source Intelligence", def: "Data collected from publicly available sources to be used in an intelligence context.", domain: "Threats" },
            { acr: "CVE", full: "Common Vulnerabilities and Exposures", def: "A list of entries—each containing an identification number, a description, and at least one public reference—for publicly known cybersecurity vulnerabilities.", domain: "Threats" },
            { acr: "CVSS", full: "Common Vulnerability Scoring System", def: "A free and open industry standard for assessing the severity of computer system security vulnerabilities.", domain: "Threats" },
            { acr: "IOC", full: "Indicators of Compromise", def: "Pieces of forensic data, such as data found in system log entries or files, that identify potentially malicious activity on a system or network.", domain: "Threats" },

            // Architecture and Design
            { acr: "DMZ", full: "Demilitarized Zone", def: "A physical or logical subnetwork that contains and exposes an organization's external-facing services to an untrusted network, usually the Internet.", domain: "Architecture" },
            { acr: "SDN", full: "Software Defined Networking", def: "An approach to networking that uses software-based controllers or APIs to communicate with underlying hardware infrastructure and direct traffic on a network.", domain: "Architecture" },
            { acr: "HIDS", full: "Host-based Intrusion Detection System", def: "An intrusion detection system that monitors and analyzes the internals of a computing system as well as the network packets on its network interfaces.", domain: "Architecture" },
            { acr: "NIDS", full: "Network-based Intrusion Detection System", def: "An intrusion detection system that attempts to detect hacking activities, denial of service attacks, or port scans on a computer network.", domain: "Architecture" },
            { acr: "TPM", full: "Trusted Platform Module", def: "A specialized chip on an endpoint device that stores RSA encryption keys specific to the host system for hardware authentication.", domain: "Architecture" },
            { acr: "HSM", full: "Hardware Security Module", def: "A physical computing device that safeguards and manages digital keys for strong authentication and provides cryptoprocessing.", domain: "Architecture" },
            { acr: "FDE", full: "Full Disk Encryption", def: "Encryption at the hardware level that protects the entire volume and all files on the drive.", domain: "Architecture" },
            { acr: "VDI", full: "Virtual Desktop Infrastructure", def: "Hosting desktop environments on a central server. It is a form of desktop virtualization.", domain: "Architecture" },
            { acr: "SaaS", full: "Software as a Service", def: "A software distribution model in which a third-party provider hosts applications and makes them available to customers over the Internet.", domain: "Architecture" },
            { acr: "IaaS", full: "Infrastructure as a Service", def: "A form of cloud computing that provides virtualized computing resources over the internet.", domain: "Architecture" },
            { acr: "PaaS", full: "Platform as a Service", def: "A cloud computing model where a third-party provider delivers hardware and software tools to users over the internet.", domain: "Architecture" },
            { acr: "CASB", full: "Cloud Access Security Broker", def: "Software that sits between cloud service users and cloud applications to monitor activity and enforce security policies.", domain: "Architecture" },

            // Implementation
            { acr: "PKI", full: "Public Key Infrastructure", def: "A set of roles, policies, hardware, software and procedures needed to create, manage, distribute, use, store and revoke digital certificates and manage public-key encryption.", domain: "Implementation" },
            { acr: "CA", full: "Certificate Authority", def: "An entity that issues digital certificates.", domain: "Implementation" },
            { acr: "CSR", full: "Certificate Signing Request", def: "A message sent from an applicant to a certificate authority in order to apply for a digital certificate.", domain: "Implementation" },
            { acr: "CRL", full: "Certificate Revocation List", def: "A list of digital certificates that have been revoked by the issuing Certificate Authority before their scheduled expiration date and should no longer be trusted.", domain: "Implementation" },
            { acr: "RA", full: "Registration Authority", def: "An authority in a network that verifies user requests for a digital certificate and tells the CA to issue it.", domain: "Implementation" },
            { acr: "AES", full: "Advanced Encryption Standard", def: "A symmetric block cipher chosen by the U.S. government to protect classified information. It is implemented in software and hardware throughout the world.", domain: "Implementation" },
            { acr: "RSA", full: "Rivest-Shamir-Adleman", def: "A public-key cryptosystem that is widely used for secure data transmission. It is also one of the oldest.", domain: "Implementation" },
            { acr: "WPA", full: "Wi-Fi Protected Access", def: "A security standard for users of computing devices equipped with wireless internet connections.", domain: "Implementation" },
            { acr: "EAP", full: "Extensible Authentication Protocol", def: "An authentication framework frequently used in network and internet connections, mainly in wireless networks and Point-to-Point connections.", domain: "Implementation" },
            { acr: "RADIUS", full: "Remote Authentication Dial-In User Service", def: "A networking protocol that provides centralized Authentication, Authorization, and Accounting (AAA) management for users who connect and use a network service.", domain: "Implementation" },
            { acr: "TACACS+", full: "Terminal Access Controller Access-Control System Plus", def: "A Cisco proprietary protocol used to communicate with an AAA server.", domain: "Implementation" },
            { acr: "Kerberos", full: "Kerberos", def: "A computer network authentication protocol that works on the basis of tickets to allow nodes communicating over a non-secure network to prove their identity to one another in a secure manner.", domain: "Implementation" },

            // Operations and Incident Response
            { acr: "SIEM", full: "Security Information and Event Management", def: "A solution that provides a holistic view of an organization's information security.", domain: "Operations" },
            { acr: "SOAR", full: "Security Orchestration, Automation, and Response", def: "A solution stack of compatible software programs that allow an organization to collect data about security threats from multiple sources and respond to low-level security events without human assistance.", domain: "Operations" },
            { acr: "DLP", full: "Data Loss Prevention", def: "A set of tools and processes used to ensure that sensitive data is not lost, misused, or accessed by unauthorized users.", domain: "Operations" },
            { acr: "EDR", full: "Endpoint Detection and Response", def: "A cyber technology that continually monitors and gathers data from endpoints to provide threat detection and response capabilities.", domain: "Operations" },
            { acr: "IR", full: "Incident Response", def: "The process of detecting, analyzing, and responding to security incidents.", domain: "Operations" },
            { acr: "BCP", full: "Business Continuity Plan", def: "A document that consists of the critical information an organization needs to continue operating during an unplanned event.", domain: "Operations" },
            { acr: "DRP", full: "Disaster Recovery Plan", def: "A documented process or set of procedures to execute an organization's disaster recovery processes and recover and protect a business IT infrastructure in the event of a disaster.", domain: "Operations" },
            { acr: "RTO", full: "Recovery Time Objective", def: "The targeted duration of time and a service level within which a business process must be restored after a disaster (or disruption) in order to avoid unacceptable consequences.", domain: "Operations" },
            { acr: "RPO", full: "Recovery Point Objective", def: "The maximum targeted period in which data might be lost from an IT service due to a major incident.", domain: "Operations" },
            { acr: "MTBF", full: "Mean Time Between Failures", def: "The predicted elapsed time between inherent failures of a mechanical or electronic system, during normal system operation.", domain: "Operations" },
            { acr: "MTTR", full: "Mean Time To Repair", def: "The average time required to repair a failed component or device.", domain: "Operations" },

            // Governance, Risk, and Compliance
            { acr: "ALE", full: "Annual Loss Expectancy", def: "The expected monetary loss for an asset due to a risk over a one-year period. ALE = SLE x ARO.", domain: "Governance" },
            { acr: "SLE", full: "Single Loss Expectancy", def: "The monetary value expected from the occurrence of a risk on an asset. SLE = AV x EF.", domain: "Governance" },
            { acr: "ARO", full: "Annual Rate of Occurrence", def: "The number of times a risk is expected to occur in a year.", domain: "Governance" },
            { acr: "NDA", full: "Non-Disclosure Agreement", def: "A legal contract between at least two parties that outlines confidential material, knowledge, or information that the parties wish to share with one another for certain purposes, but wish to restrict access to.", domain: "Governance" },
            { acr: "SLA", full: "Service Level Agreement", def: "A commitment between a service provider and a client. Particular aspects of the service – quality, availability, responsibilities – are agreed between the service provider and the service user.", domain: "Governance" },
            { acr: "AUP", full: "Acceptable Use Policy", def: "A document stipulating constraints and practices that a user must agree to for access to a corporate network or the internet.", domain: "Governance" },
            { acr: "GDPR", full: "General Data Protection Regulation", def: "A regulation in EU law on data protection and privacy in the European Union and the European Economic Area.", domain: "Governance" },
            { acr: "PCI DSS", full: "Payment Card Industry Data Security Standard", def: "An information security standard for organizations that handle branded credit cards from the major card schemes.", domain: "Governance" },
            { acr: "BIA", full: "Business Impact Analysis", def: "A systematic process to determine and evaluate the potential effects of an interruption to critical business operations as a result of a disaster, accident, or emergency.", domain: "Governance" },
            { acr: "MOU", full: "Memorandum of Understanding", def: "A formal agreement between two or more parties. MOUs are not legally binding but carry a degree of seriousness and mutual respect.", domain: "Governance" },
            { acr: "MOA", full: "Memorandum of Agreement", def: "A cooperative agreement (or a conditional purchase order) between two parties to work together on a project or meet an agreed upon objective.", domain: "Governance" },
            { acr: "ISA", full: "Interconnection Security Agreement", def: "An agreement established between the organizations that own and operate connected IT systems to document the technical requirements of the interconnection.", domain: "Governance" }
        ];

        // Application Logic
        const app = {
            state: {
                currentView: 'dashboard',
                flashcardIndex: 0,
                flashcardFlipped: false,
                quizScore: 0,
                quizCurrentQuestion: null,
                isAiQuiz: false
            },

            init() {
                this.setupNavigation();
                this.renderDashboard();
                this.renderLibrary();
                this.setupEventListeners();
                this.setupKeyboardNav();
            },

            // --- Navigation & Views ---
            setupNavigation() {
                const navItems = [
                    { id: 'dashboard', label: 'Dashboard' },
                    { id: 'library', label: 'Library' },
                    { id: 'flashcards', label: 'Flashcards' },
                    { id: 'quiz', label: 'Quiz' }
                ];

                const desktopNav = document.getElementById('desktop-nav');
                const mobileNav = document.getElementById('mobile-nav-items');

                navItems.forEach(item => {
                    // Desktop
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = item.label;
                    link.className = 'inactive-tab inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors duration-200';
                    link.onclick = (e) => { e.preventDefault(); this.switchView(item.id); };
                    link.dataset.view = item.id;
                    desktopNav.appendChild(link);

                    // Mobile
                    const mLink = document.createElement('a');
                    mLink.href = '#';
                    mLink.textContent = item.label;
                    mLink.className = 'block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50';
                    mLink.onclick = (e) => { e.preventDefault(); this.switchView(item.id); document.getElementById('mobile-menu').classList.add('hidden'); };
                    mobileNav.appendChild(mLink);
                });

                this.updateNavStyles();
            },

            switchView(viewId) {
                document.querySelectorAll('section[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
                
                this.state.currentView = viewId;
                this.updateNavStyles();

                if (viewId === 'flashcards') this.loadFlashcard(this.state.flashcardIndex);
                // Only reset quiz if moving TO quiz and it's empty, otherwise keep state
                if (viewId === 'quiz' && !this.state.quizCurrentQuestion) this.nextQuizQuestion();
                
                window.scrollTo(0,0);
            },

            updateNavStyles() {
                const links = document.querySelectorAll('#desktop-nav a');
                links.forEach(link => {
                    if (link.dataset.view === this.state.currentView) {
                        link.className = 'active-tab inline-flex items-center px-1 pt-1 text-sm font-medium';
                    } else {
                        link.className = 'inactive-tab inline-flex items-center px-1 pt-1 text-sm font-medium transition-colors duration-200';
                    }
                });
            },

            // --- Dashboard ---
            renderDashboard() {
                const domains = [...new Set(appData.map(d => d.domain))];
                const domainCounts = domains.map(d => appData.filter(item => item.domain === d).length);
                const complexity = ['Basic', 'Intermediate', 'Advanced'];
                const complexityCounts = [15, 25, 12]; 

                new Chart(document.getElementById('domainChart'), {
                    type: 'doughnut',
                    data: {
                        labels: domains,
                        datasets: [{
                            data: domainCounts,
                            backgroundColor: ['#0D9488', '#F59E0B', '#6366F1', '#EC4899', '#14B8A6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom', labels: { boxWidth: 12, usePointStyle: true } }
                        }
                    }
                });

                new Chart(document.getElementById('complexityChart'), {
                    type: 'bar',
                    data: {
                        labels: complexity,
                        datasets: [{
                            label: 'Term Count',
                            data: complexityCounts,
                            backgroundColor: ['#A7F3D0', '#5EEAD4', '#0F766E'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } }
                    }
                });
            },

            // --- Library ---
            renderLibrary() {
                const filterContainer = document.getElementById('domain-filters');
                const domains = ['All', ...new Set(appData.map(d => d.domain))];
                
                domains.forEach(d => {
                    const btn = document.createElement('button');
                    btn.textContent = d;
                    btn.className = `px-3 py-1 rounded-full text-xs font-semibold border transition-all ${d === 'All' ? 'bg-teal-600 text-white border-teal-600' : 'bg-white text-gray-600 border-gray-200 hover:border-teal-300'}`;
                    btn.onclick = () => this.filterLibrary(d, btn);
                    filterContainer.appendChild(btn);
                });

                this.filterLibrary('All', filterContainer.children[0]);
            },

            filterLibrary(domain, activeBtn) {
                const buttons = document.getElementById('domain-filters').children;
                Array.from(buttons).forEach(b => {
                    b.className = 'px-3 py-1 rounded-full text-xs font-semibold border bg-white text-gray-600 border-gray-200 hover:border-teal-300 transition-all';
                });
                activeBtn.className = 'px-3 py-1 rounded-full text-xs font-semibold border bg-teal-600 text-white border-teal-600 shadow-sm';

                const input = document.getElementById('searchInput').value.toLowerCase();
                const filtered = appData.filter(item => {
                    const matchesDomain = domain === 'All' || item.domain === domain;
                    const matchesSearch = item.acr.toLowerCase().includes(input) || 
                                        item.full.toLowerCase().includes(input) || 
                                        item.def.toLowerCase().includes(input);
                    return matchesDomain && matchesSearch;
                });

                const grid = document.getElementById('library-grid');
                grid.innerHTML = '';
                const noRes = document.getElementById('no-results');

                if (filtered.length === 0) {
                    noRes.classList.remove('hidden');
                } else {
                    noRes.classList.add('hidden');
                    filtered.forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow group flex flex-col justify-between h-full';
                        card.innerHTML = `
                            <div>
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-xl font-bold text-gray-800 group-hover:text-teal-600 transition-colors">${item.acr}</h3>
                                    <span class="px-2 py-0.5 bg-gray-100 text-gray-500 text-[10px] uppercase font-bold rounded">${item.domain}</span>
                                </div>
                                <p class="text-sm font-semibold text-gray-600 mb-2">${item.full}</p>
                                <p class="text-sm text-gray-500 leading-relaxed">${item.def}</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-50">
                                <button onclick="app.explainTerm('${item.acr}', '${item.full}')" class="text-xs font-bold text-teal-600 hover:text-teal-800 flex items-center gap-1 transition-colors">
                                    <span>✨</span> Explain like I'm 5
                                </button>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                }
            },

            // --- Flashcards ---
            loadFlashcard(index) {
                this.state.flashcardFlipped = false;
                document.getElementById('flashcard-inner').classList.remove('rotate-y-180');
                
                setTimeout(() => {
                    const item = appData[index];
                    document.getElementById('card-front').textContent = item.acr;
                    document.getElementById('card-domain').textContent = item.domain;
                    document.getElementById('card-fullform').textContent = item.full;
                    document.getElementById('card-def').textContent = item.def;
                    document.getElementById('card-counter').textContent = `${index + 1} / ${appData.length}`;
                }, 150);
            },

            flipCard() {
                this.state.flashcardFlipped = !this.state.flashcardFlipped;
                const inner = document.getElementById('flashcard-inner');
                if (this.state.flashcardFlipped) inner.classList.add('rotate-y-180');
                else inner.classList.remove('rotate-y-180');
            },

            nextCard() {
                this.state.flashcardIndex = (this.state.flashcardIndex + 1) % appData.length;
                this.loadFlashcard(this.state.flashcardIndex);
            },

            prevCard() {
                this.state.flashcardIndex = (this.state.flashcardIndex - 1 + appData.length) % appData.length;
                this.loadFlashcard(this.state.flashcardIndex);
            },

            // --- Quiz Logic ---
            nextQuizQuestion() {
                this.state.isAiQuiz = false;
                document.getElementById('ai-quiz-badge').classList.add('hidden');
                document.getElementById('quiz-feedback').classList.add('hidden');
                document.getElementById('quiz-feedback').className = 'hidden p-4 text-center font-bold text-white transition-colors duration-300';
                document.getElementById('quiz-body').classList.remove('hidden');
                document.getElementById('quiz-loading').classList.add('hidden');

                const randIndex = Math.floor(Math.random() * appData.length);
                const correctItem = appData[randIndex];
                this.state.quizCurrentQuestion = { ...correctItem, answer: correctItem.full };

                let wrongItems = [];
                while (wrongItems.length < 3) {
                    const wrong = appData[Math.floor(Math.random() * appData.length)];
                    if (wrong.acr !== correctItem.acr && !wrongItems.includes(wrong)) {
                        wrongItems.push(wrong);
                    }
                }

                const allOptions = [correctItem.full, ...wrongItems.map(w => w.full)].sort(() => Math.random() - 0.5);

                this.renderQuizUI(correctItem.acr, allOptions, "What does this stand for?");
                
                // Update Counter
                const qNum = document.getElementById('quiz-q-num');
                qNum.textContent = parseInt(qNum.textContent) + 1;
            },

            renderQuizUI(questionText, options, subtitle) {
                document.getElementById('quiz-question').textContent = questionText;
                document.querySelector('#quiz-body h3').textContent = subtitle;
                
                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = '';

                options.forEach(optText => {
                    const btn = document.createElement('button');
                    btn.className = 'w-full text-left p-4 rounded-lg border border-gray-200 hover:bg-teal-50 hover:border-teal-200 transition-colors text-gray-700 font-medium';
                    btn.textContent = optText;
                    btn.onclick = () => this.checkQuizAnswer(optText, btn);
                    optionsContainer.appendChild(btn);
                });
            },

            checkQuizAnswer(selectedText, btnElement) {
                const feedback = document.getElementById('quiz-feedback');
                feedback.classList.remove('hidden');

                const isCorrect = selectedText === this.state.quizCurrentQuestion.answer;

                if (isCorrect) {
                    this.state.quizScore++;
                    document.getElementById('quiz-score').textContent = `Score: ${this.state.quizScore}`;
                    feedback.textContent = "Correct! " + (this.state.quizCurrentQuestion.def || "");
                    feedback.classList.add('bg-teal-500');
                    btnElement.classList.add('bg-teal-600', 'text-white', 'border-teal-600');
                } else {
                    feedback.textContent = `Incorrect. The correct answer was: ${this.state.quizCurrentQuestion.answer}`;
                    feedback.classList.add('bg-red-500');
                    btnElement.classList.add('bg-red-500', 'text-white', 'border-red-500');
                }

                const opts = document.getElementById('quiz-options').children;
                Array.from(opts).forEach(b => b.disabled = true);
            },

            // --- AI Features (Gemini Integration) ---

            async callGemini(prompt) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) throw new Error('API Error');
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (error) {
                    console.error("Gemini Error:", error);
                    return null;
                }
            },

            async explainTerm(acr, full) {
                const modal = document.getElementById('ai-modal');
                const content = document.getElementById('ai-content');
                const loading = document.getElementById('ai-loading');
                const title = document.getElementById('ai-modal-title');

                title.textContent = `Explain: ${acr}`;
                content.innerHTML = '';
                loading.classList.remove('hidden');
                modal.classList.remove('hidden');

                const prompt = `Explain the cybersecurity term "${acr}" (${full}) simply, like I'm a beginner or 5 years old. Use a fun analogy. Then, provide one short real-world example of how it is used or how an attack happens. Keep total response under 150 words.`;
                
                const text = await this.callGemini(prompt);
                
                loading.classList.add('hidden');
                if (text) {
                    content.textContent = text;
                } else {
                    content.textContent = "Sorry, the AI tutor is currently offline. Please try again later.";
                }
            },

            async generateAIQuiz() {
                // UI State Updates
                document.getElementById('quiz-body').classList.add('hidden');
                document.getElementById('quiz-feedback').classList.add('hidden');
                document.getElementById('quiz-loading').classList.remove('hidden');
                document.getElementById('ai-quiz-badge').classList.remove('hidden');
                
                const prompt = `Generate a single multiple-choice question for the CompTIA Security+ exam. 
                Do NOT use common acronyms like DoS or Phishing if possible, try a slightly harder topic.
                Return ONLY a JSON object with this exact structure:
                {
                    "question": "The question text here",
                    "options": ["Option A", "Option B", "Option C", "Option D"],
                    "correctAnswer": "The exact text of the correct option",
                    "explanation": "A brief explanation of why it is correct"
                }
                Do not include markdown formatting like \`\`\`json. just the raw json string.`;

                const text = await this.callGemini(prompt);
                document.getElementById('quiz-loading').classList.add('hidden');
                document.getElementById('quiz-body').classList.remove('hidden');

                if (text) {
                    try {
                        const cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();
                        const data = JSON.parse(cleanText);
                        
                        this.state.isAiQuiz = true;
                        this.state.quizCurrentQuestion = { 
                            answer: data.correctAnswer, 
                            def: data.explanation 
                        };

                        this.renderQuizUI(data.question, data.options, "AI Generated Challenge ✨");

                        // Update Counter
                        const qNum = document.getElementById('quiz-q-num');
                        qNum.textContent = parseInt(qNum.textContent) + 1;

                    } catch (e) {
                        console.error("Parse Error", e);
                        alert("AI generated invalid data. Trying standard question.");
                        this.nextQuizQuestion();
                    }
                } else {
                    alert("AI connection failed. Loading standard question.");
                    this.nextQuizQuestion();
                }
            },

            closeAIModal() {
                document.getElementById('ai-modal').classList.add('hidden');
            },

            // --- Utilities ---
            setupEventListeners() {
                document.getElementById('mobile-menu-btn').onclick = () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                };

                document.getElementById('searchInput').addEventListener('input', () => {
                    const btns = document.getElementById('domain-filters').children;
                    let activeDomain = 'All';
                    Array.from(btns).forEach(b => {
                        if (b.classList.contains('bg-teal-600')) activeDomain = b.textContent;
                    });
                    const input = document.getElementById('searchInput').value.toLowerCase();
                    const filtered = appData.filter(item => {
                        const matchesDomain = activeDomain === 'All' || item.domain === activeDomain;
                        const matchesSearch = item.acr.toLowerCase().includes(input) || 
                                            item.full.toLowerCase().includes(input) || 
                                            item.def.toLowerCase().includes(input);
                        return matchesDomain && matchesSearch;
                    });
                    
                    const grid = document.getElementById('library-grid');
                    grid.innerHTML = '';
                    const noRes = document.getElementById('no-results');

                    if (filtered.length === 0) {
                        noRes.classList.remove('hidden');
                    } else {
                        noRes.classList.add('hidden');
                        filtered.forEach(item => {
                            const card = document.createElement('div');
                            card.className = 'bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow group flex flex-col justify-between h-full';
                            card.innerHTML = `
                                <div>
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="text-xl font-bold text-gray-800 group-hover:text-teal-600 transition-colors">${item.acr}</h3>
                                        <span class="px-2 py-0.5 bg-gray-100 text-gray-500 text-[10px] uppercase font-bold rounded">${item.domain}</span>
                                    </div>
                                    <p class="text-sm font-semibold text-gray-600 mb-2">${item.full}</p>
                                    <p class="text-sm text-gray-500 leading-relaxed">${item.def}</p>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-50">
                                    <button onclick="app.explainTerm('${item.acr}', '${item.full}')" class="text-xs font-bold text-teal-600 hover:text-teal-800 flex items-center gap-1 transition-colors">
                                        <span>✨</span> Explain like I'm 5
                                    </button>
                                </div>
                            `;
                            grid.appendChild(card);
                        });
                    }
                });
            },

            setupKeyboardNav() {
                document.addEventListener('keydown', (e) => {
                    if (this.state.currentView === 'flashcards') {
                        if (e.code === 'Space') {
                            e.preventDefault();
                            this.flipCard();
                        } else if (e.code === 'ArrowRight') {
                            this.nextCard();
                        } else if (e.code === 'ArrowLeft') {
                            this.prevCard();
                        }
                    }
                });
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>
